<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í˜¼ìí•˜ëŠ” í¬ì»¤ vs AI</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #2e7d32;
    color: white;
    padding: 20px;
  }
  .cards {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    flex-wrap: wrap;
  }
  .card {
    width: 60px;
    height: 90px;
    border: 2px solid #fff;
    border-radius: 8px;
    background: #fff;
    color: #000;
    font-size: 18px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 5px;
    cursor: pointer;
    user-select: none;
  }
  .held {
    background: #fdd835;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 10px 5px;
    cursor: pointer;
  }
  .info {
    margin-top: 15px;
    font-size: 18px;
  }
  .result {
    font-size: 20px;
    margin-top: 15px;
    font-weight: bold;
  }
  .player-area, .ai-area {
    margin-bottom: 30px;
  }
</style>
</head>
<body>
  <h1>í˜¼ìí•˜ëŠ” í¬ì»¤ vs AI</h1>
  <div class="player-area">
    <h2>ë‚´ ì¹´ë“œ</h2>
    <p>ì¹´ë“œë¥¼ ëˆŒëŸ¬ ê³ ì •(hold)í•˜ê³  ë‹¤ì‹œ ë½‘ìœ¼ì„¸ìš”.</p>
    <div class="cards" id="player-hand"></div>
    <button id="draw-btn" onclick="drawHand()">ì¹´ë“œ ë°›ê¸°</button>
    <button id="redraw-btn" onclick="redraw()" disabled>ë‹¤ì‹œ ë½‘ê¸°</button>
    <div class="info" id="player-info"></div>
  </div>

  <div class="ai-area">
    <h2>AI ì¹´ë“œ</h2>
    <div class="cards" id="ai-hand"></div>
    <div class="info" id="ai-info"></div>
  </div>

  <div class="result" id="result"></div>

<script>
const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
let deck = [];
let playerHand = [];
let aiHand = [];
let held = [false, false, false, false, false];
let redrawCount = 0;

const handRanks = [
  "í•˜ì´ì¹´ë“œ",
  "ì›í˜ì–´",
  "íˆ¬í˜ì–´",
  "íŠ¸ë¦¬í”Œ",
  "ìŠ¤íŠ¸ë ˆì´íŠ¸",
  "í”ŒëŸ¬ì‹œ",
  "í’€í•˜ìš°ìŠ¤",
  "í¬ì¹´ë“œ",
  "ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ",
  "ë¡œì—´ í”ŒëŸ¬ì‹œ"
];

// 5ì¥ í¬ì»¤ ì¡±ë³´ ëŒ€ëµ í™•ë¥  (5ì¥ ë“œë¡œìš° í¬ì»¤ ê¸°ì¤€, %)
const handProbabilities = {
  "ë¡œì—´ í”ŒëŸ¬ì‹œ": 0.00015,
  "ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ": 0.0015,
  "í¬ì¹´ë“œ": 0.024,
  "í’€í•˜ìš°ìŠ¤": 0.144,
  "í”ŒëŸ¬ì‹œ": 0.197,
  "ìŠ¤íŠ¸ë ˆì´íŠ¸": 0.392,
  "íŠ¸ë¦¬í”Œ": 2.11,
  "íˆ¬í˜ì–´": 4.75,
  "ì›í˜ì–´": 42.3,
  "í•˜ì´ì¹´ë“œ": 50.1
};

// --- ì¹´ë“œ ë± ìƒì„±, ì…”í”Œ ---
function createDeck() {
  deck = [];
  for (let suit of suits) {
    for (let value of values) {
      deck.push({ suit, value, rank: values.indexOf(value) });
    }
  }
  shuffle(deck);
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// --- ì¡±ë³´ íŒë‹¨ í•¨ìˆ˜ ---
// 5ì¥ ì¹´ë“œ ë°°ì—´ì„ ë°›ê³  ì¡±ë³´ ë²ˆí˜¸ì™€ ì´ë¦„ ë¦¬í„´
function evaluateHand(cards) {
  const ranks = cards.map(c => c.rank).sort((a,b) => a-b);
  const suitsArr = cards.map(c => c.suit);

  const isFlush = suitsArr.every(s => s === suitsArr[0]);

  // ìŠ¤íŠ¸ë ˆì´íŠ¸ ì²´í¬ (Ace lowë„ ê³ ë ¤)
  function isStraight(ranks) {
    for(let i=1; i<ranks.length; i++){
      if(ranks[i] !== ranks[i-1]+1) return false;
    }
    return true;
  }

  let straight = false;
  if (isStraight(ranks)) {
    straight = true;
  } else {
    // A,2,3,4,5 ì²˜ë¦¬ ìœ„í•´ Ace=12ë¥¼ 0ìœ¼ë¡œ ë³€ê²½ í›„ ì²´í¬
    if (ranks.includes(12)) {
      let lowAceRanks = ranks.slice();
      lowAceRanks[lowAceRanks.indexOf(12)] = -1;
      lowAceRanks.sort((a,b) => a-b);
      if (isStraight(lowAceRanks)) {
        straight = true;
      }
    }
  }

  // ë­í¬ë³„ ê°œìˆ˜ ì„¸ê¸°
  let counts = {};
  for (let r of ranks) counts[r] = (counts[r]||0)+1;

  const countsArr = Object.values(counts).sort((a,b) => b - a); // ë‚´ë¦¼ì°¨ìˆœ
  const distinctRanks = Object.keys(counts).length;

  // ì¡±ë³´ íŒì •
  if (straight && isFlush && ranks.includes(8) && ranks.includes(9) && ranks.includes(10) && ranks.includes(11) && ranks.includes(12)) {
    return {rank:9, name:"ë¡œì—´ í”ŒëŸ¬ì‹œ"};
  }
  if (straight && isFlush) return {rank:8, name:"ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ"};
  if (countsArr[0] === 4) return {rank:7, name:"í¬ì¹´ë“œ"};
  if (countsArr[0] === 3 && countsArr[1] === 2) return {rank:6, name:"í’€í•˜ìš°ìŠ¤"};
  if (isFlush) return {rank:5, name:"í”ŒëŸ¬ì‹œ"};
  if (straight) return {rank:4, name:"ìŠ¤íŠ¸ë ˆì´íŠ¸"};
  if (countsArr[0] === 3) return {rank:3, name:"íŠ¸ë¦¬í”Œ"};
  if (countsArr[0] === 2 && countsArr[1] === 2) return {rank:2, name:"íˆ¬í˜ì–´"};
  if (countsArr[0] === 2) return {rank:1, name:"ì›í˜ì–´"};
  return {rank:0, name:"í•˜ì´ì¹´ë“œ"};
}

// ì¡±ë³´ ìŠ¹ë¶€ ë¹„êµ (ë†’ì€ ì¡±ë³´ ìŠ¹ë¦¬, ë™ì  ì‹œ ì¹´ë“œ ë¹„êµ ê°„ëµ ì²˜ë¦¬)
function compareHands(handA, handB) {
  if (handA.rank > handB.rank) return 1;
  if (handA.rank < handB.rank) return -1;

  // ë™ì ì´ë©´ ì¹´ë“œ ë­í¬ ë‚´ë¦¼ì°¨ìˆœ ë¹„êµ
  const aRanks = handA.cards.map(c => c.rank).sort((a,b)=>b-a);
  const bRanks = handB.cards.map(c => c.rank).sort((a,b)=>b-a);

  for(let i=0; i<aRanks.length; i++){
    if (aRanks[i] > bRanks[i]) return 1;
    if (aRanks[i] < bRanks[i]) return -1;
  }
  return 0; // ì™„ì „ ë™ì 
}

// --- UI ê´€ë ¨ ---
function renderCards(containerId, cards, heldArray = []) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  cards.forEach((card, idx) => {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'card' + (heldArray[idx] ? ' held' : '');
    cardDiv.innerHTML = `${card.value}<br>${card.suit}`;
    if(containerId === 'player-hand') {
      cardDiv.onclick = () => {
        held[idx] = !held[idx];
        renderCards(containerId, cards, held);
      }
    }
    container.appendChild(cardDiv);
  });
}

function displayInfo(id, handEval) {
  const info = document.getElementById(id);
  const prob = handProbabilities[handEval.name] || 0;
  info.innerHTML = `íŒ¨: <b>${handEval.name}</b> (í™•ë¥  ì•½ ${prob.toFixed(3)}%)`;
}

function displayResult(text) {
  document.getElementById('result').textContent = text;
}

function disableButtons(drawing) {
  document.getElementById('draw-btn').disabled = drawing;
  document.getElementById('redraw-btn').disabled = !drawing;
}

// --- ê²Œì„ ë¡œì§ ---
function drawHand() {
  createDeck();
  playerHand = [];
  aiHand = [];
  held = [false, false, false, false, false];
  redrawCount = 0;

  for (let i=0; i<5; i++) playerHand.push(deck.pop());
  for (let i=0; i<5; i++) aiHand.push(deck.pop());

  renderCards('player-hand', playerHand, held);
  renderCards('ai-hand', aiHand, Array(5).fill(false));

  const playerEval = evaluateHand(playerHand);
  displayInfo('player-info', playerEval);

  // AI ì •ë³´ëŠ” í”Œë ˆì´ì–´ê°€ ë‹¤ì‹œ ë½‘ê¸° ëë‚  ë•Œê¹Œì§€ ì•ˆ ë³´ì—¬ì¤Œ
  document.getElementById('ai-info').textContent = "AIëŠ” í”Œë ˆì´ì–´ê°€ ì¹´ë“œ ë½‘ê¸°ë¥¼ ë§ˆì¹  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.";

  displayResult('');
  disableButtons(false);
}

function redraw() {
  if (redrawCount >= 1) {
    alert("ë‹¤ì‹œ ë½‘ê¸°ëŠ” 1íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    return;
  }
  redrawCount++;

  for(let i=0; i<5; i++){
    if (!held[i]) {
      playerHand[i] = deck.pop();
    }
  }

  renderCards('player-hand', playerHand, held);

  const playerEval = evaluateHand(playerHand);
  displayInfo('player-info', playerEval);

  aiRedraw();

  const aiEval = evaluateHand(aiHand);
  renderCards('ai-hand', aiHand, Array(5).fill(false));
  displayInfo('ai-info', aiEval);

  const cmp = compareHands(
    {rank: playerEval.rank, cards: playerHand},
    {rank: aiEval.rank, cards: aiHand}
  );
  if (cmp > 0) displayResult("ğŸ‰ ë‹¹ì‹ ì´ ì´ê²¼ìŠµë‹ˆë‹¤!");
  else if (cmp < 0) displayResult("ğŸ’» AIê°€ ì´ê²¼ìŠµë‹ˆë‹¤!");
  else displayResult("ğŸ¤ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤.");

  disableButtons(true);
}

function aiRedraw() {
  // AIëŠ” ê°„ë‹¨íˆ ëœë¤ìœ¼ë¡œ 1~3ì¥ êµì²´,
